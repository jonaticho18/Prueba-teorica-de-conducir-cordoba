<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cuestionario – Guía del Buen Conductor (Córdoba)</title>
  <style>
    :root {
      --bg: #0b1320;
      --card: #111a2b;
      --muted: #9fb0cf;
      --text: #e8f0ff;
      --accent: #54a0ff;
      --accent-2: #00d2d3;
      --danger: #ff6b6b;
      --ok: #10d38a;
    }
    * { box-sizing: border-box; }
    body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial, "Noto Sans", sans-serif; background: linear-gradient(180deg, var(--bg), #0e1730 40%, #0a1021); color: var(--text); }
    header { padding: 24px 16px; text-align: center; }
    header h1 { margin: 0 0 6px; font-size: clamp(20px, 4vw, 28px); }
    header p { margin: 0; color: var(--muted); }

    .container { max-width: 950px; margin: 0 auto; padding: 16px; }
    .card { background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02)); border: 1px solid rgba(255,255,255,0.09); border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,0.35); overflow: hidden; }
    .card-header { padding: 16px 20px; display: flex; align-items: center; justify-content: space-between; gap: 8px; flex-wrap: wrap; }
    .badge { font-size: 12px; padding: 6px 10px; border-radius: 999px; background: rgba(84,160,255,0.15); color: #cfe1ff; border: 1px solid rgba(84,160,255,0.35); }
    .progress { flex: 1; height: 8px; background: rgba(255,255,255,0.08); border-radius: 999px; overflow: hidden; min-width: 180px; }
    .progress > div { height: 100%; background: linear-gradient(90deg, var(--accent), var(--accent-2)); width: 0%; transition: width .25s ease; }

    .card-body { padding: 20px; }
    .question { font-size: clamp(18px, 2.6vw, 22px); margin-bottom: 14px; line-height: 1.35; }
    .options { display: grid; gap: 10px; }
    .opt { display: flex; gap: 10px; align-items: flex-start; border: 1px solid rgba(255,255,255,0.12); border-radius: 12px; padding: 12px 14px; cursor: pointer; background: rgba(255,255,255,0.015); }
    .opt input { margin-top: 3px; accent-color: var(--accent); }
    .opt:hover { border-color: rgba(84,160,255,0.45); box-shadow: 0 6px 18px rgba(84,160,255,0.15) inset; }
    .muted { color: var(--muted); font-size: 14px; }
    .actions { display: flex; gap: 10px; margin-top: 16px; flex-wrap: wrap; }
    button { border: 0; padding: 12px 16px; border-radius: 12px; font-weight: 600; cursor: pointer; }
    .btn { background: linear-gradient(180deg, var(--accent), #3c7fe0); color: #04142b; }
    .btn:disabled { opacity: .6; cursor: not-allowed; }
    .btn-secondary { background: rgba(255,255,255,0.08); color: var(--text); border: 1px solid rgba(255,255,255,0.12); }

    .result { display: none; padding: 24px; text-align: center; }
    .score { font-size: clamp(24px, 5vw, 36px); margin: 0 0 8px; }
    .score.good { color: var(--ok); }
    .score.ok { color: #ffd166; }
    .score.bad { color: var(--danger); }

    details.review { text-align: left; border-top: 1px dashed rgba(255,255,255,0.2); margin-top: 16px; padding-top: 16px; }
    details.review summary { cursor: pointer; margin-bottom: 8px; }
    .review-item { border: 1px solid rgba(255,255,255,0.12); border-radius: 12px; padding: 12px 14px; margin-bottom: 10px; background: rgba(255,255,255,0.02); }
    .review-item.correct { border-color: rgba(16,211,138,.6); }
    .review-item.incorrect { border-color: rgba(255,107,107,.6); }

    footer { text-align: center; padding: 24px 16px; color: var(--muted); }
    .small { font-size: 12px; }
  </style>
</head>
<body>
  <header>
    <h1>Simulador – Examen Teórico (Córdoba Capital)</h1>
    <p>Banco de preguntas basado en la "Guía del Buen Conductor" municipal. Prototipo para GitHub Pages.</p>
  </header>

  <main class="container">
    <div class="card" id="quizCard">
      <div class="card-header">
        <span class="badge" id="counter">Pregunta 1/10</span>
        <div class="progress" aria-label="Progreso"><div id="bar"></div></div>
        <span class="badge" id="timer" title="Tiempo transcurrido">00:00</span>
      </div>
      <div class="card-body">
        <div id="screen-start">
          <h2 style="margin-top:0">¿Listo para practicar?</h2>
          <p class="muted">Este prototipo incluye 10 preguntas de muestra. Podés ampliar el banco editando el arreglo <code>QUESTIONS</code> en el código.</p>
          <div class="actions">
            <button class="btn" id="startBtn">Comenzar</button>
          </div>
        </div>

        <div id="screen-quiz" style="display:none">
          <div class="question" id="qText"></div>
          <form id="opts" class="options" autocomplete="off"></form>
          <div class="actions">
            <button class="btn-secondary" id="skipBtn" type="button" title="Marca y pasa a la siguiente">Omitir</button>
            <button class="btn" id="nextBtn" type="button" disabled>Siguiente</button>
          </div>
          <p class="muted" id="helper"></p>
        </div>

        <div id="screen-result" class="result">
          <h3 class="score" id="score"></h3>
          <p id="summary" class="muted"></p>
          <div class="actions" style="justify-content:center">
            <button class="btn" id="retryBtn">Volver a intentar</button>
            <button class="btn-secondary" id="shuffleBtn">Otra tanda aleatoria</button>
          </div>
          <details class="review" id="review">
            <summary>Ver correcciones</summary>
            <div id="reviewList"></div>
          </details>
        </div>
      </div>
    </div>

    <footer>
      <p class="small">Prototipo educativo. No sustituye normativa vigente ni criterios de examinación oficiales.</p>
    </footer>
  </main>

  <script>
    // --- Banco de preguntas (muestra) ---
    // Estructura: { q: "texto", a: ["opción A", "opción B", "opción C"], correct: 0 }
    // Fuente: Guía del Buen Conductor – Municipalidad de Córdoba.
    const QUESTIONS = [
      { q: "La luz amarilla intermitente del semáforo indica:", a: ["Disminuir la marcha y circular con máxima precaución.", "Prioridad de paso.", "Prohibido pasar."], correct: 0 },
      { q: "¿Quién tiene prioridad de paso en una rotonda?", a: ["El que intenta ingresar a la misma.", "El que está circulando por la misma.", "El que egresa hacia la calle principal."], correct: 1 },
      { q: "La banda de detención (línea transversal ancha) indica:", a: ["Cruce peatonal.", "Obligación de detener el vehículo antes de esta línea.", "Separación de carriles."], correct: 1 },
      { q: "En curvas o pendientes, la doble línea continua indica:", a: ["Que puede adelantarse.", "Que no se puede adelantar.", "Que hay un obstáculo en el camino."], correct: 1 },
      { q: "Velocidad máxima en avenidas de la Ciudad de Córdoba:", a: ["40 km/h", "60 km/h", "80 km/h"], correct: 1 },
      { q: "Al girar en esquina con semáforo, los vehículos deben ceder el paso a peatones con luz verde:", a: ["Sí.", "No, el vehículo tiene prioridad.", "Sólo de noche."], correct: 0 },
      { q: "Antes de girar a izquierda o derecha, la maniobra debe señalizarse con antelación de:", a: ["20 m", "30 m", "10 m"], correct: 1 },
      { q: "La luz roja intermitente del semáforo significa:", a: ["Ceda el paso.", "PARE.", "Disminuir la velocidad."], correct: 1 },
      { q: "Sin vereda, el peatón debe caminar:", a: ["Fuera de la calzada, en sentido contrario al tránsito vehicular.", "Sobre la calzada, en el mismo sentido del tránsito.", "Fuera de la calzada, en el mismo sentido del tránsito."], correct: 0 },
      { q: "En calzada de dos o más carriles del mismo sentido, el vehículo debe:", a: ["Circular por cualquier carril.", "Circular por el izquierdo y dejar el derecho a los lentos.", "Circular por el carril derecho y usar el izquierdo sólo para adelantar."], correct: 2 }
    ];

    // --- Estado de la app ---
    let order = [];          // orden de preguntas
    let idx = 0;             // índice actual
    let answers = [];        // respuestas del usuario (índice u "omitida")
    let startTime = null;    // para el temporizador
    let timerId = null;

    // --- Utilidades ---
    const $ = (sel) => document.querySelector(sel);
    function formatTime(ms){
      const t = Math.floor(ms/1000); const m = String(Math.floor(t/60)).padStart(2,'0'); const s = String(t%60).padStart(2,'0');
      return `${m}:${s}`;
    }
    function shuffle(arr){
      const a = [...arr];
      for(let i=a.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [a[i],a[j]] = [a[j],a[i]];
      }
      return a;
    }

    // --- Flujo ---
    const startBtn = $('#startBtn');
    const skipBtn = $('#skipBtn');
    const nextBtn = $('#nextBtn');
    const retryBtn = $('#retryBtn');
    const shuffleBtn = $('#shuffleBtn');

    startBtn.addEventListener('click', () => startQuiz('sequential'));
    retryBtn.addEventListener('click', () => startQuiz('sequential'));
    shuffleBtn.addEventListener('click', () => startQuiz('random'));

    function startQuiz(mode){
      // preparar estado
      const n = QUESTIONS.length;
      order = mode === 'random' ? shuffle([...Array(n).keys()]) : [...Array(n).keys()];
      idx = 0; answers = new Array(n).fill(null);
      startTime = Date.now();
      $('#screen-start').style.display = 'none';
      $('#screen-result').style.display = 'none';
      $('#screen-quiz').style.display = '';
      nextBtn.disabled = true; $('#helper').textContent = '';
      // temporizador
      clearInterval(timerId);
      timerId = setInterval(()=>{ $('#timer').textContent = formatTime(Date.now()-startTime); }, 500);
      renderQuestion();
    }

    function renderQuestion(){
      const qIndex = order[idx];
      const q = QUESTIONS[qIndex];
      $('#qText').textContent = q.q;
      $('#counter').textContent = `Pregunta ${idx+1}/${QUESTIONS.length}`;
      const pct = ((idx)/QUESTIONS.length)*100;
      $('#bar').style.width = pct + '%';
      const form = $('#opts');
      form.innerHTML = '';
      q.a.forEach((txt, i) => {
        const id = `opt-${i}`;
        const wrap = document.createElement('label');
        wrap.className = 'opt';
        wrap.innerHTML = `<input type="radio" name="opt" value="${i}" aria-label="${txt}" /> <div>${txt}</div>`;
        form.appendChild(wrap);
      });
      form.addEventListener('change', onSelect, { once: true });
      nextBtn.onclick = next;
      skipBtn.onclick = skip;
      nextBtn.disabled = true; $('#helper').textContent = '';
    }

    function onSelect(e){
      const chosen = Number(document.querySelector('input[name="opt"]:checked')?.value);
      answers[order[idx]] = chosen;
      nextBtn.disabled = false; $('#helper').textContent = 'Respuesta seleccionada. Podés cambiarla antes de avanzar.';
    }

    function skip(){
      answers[order[idx]] = 'omitida';
      next();
    }

    function next(){
      if(idx < order.length - 1){
        idx++; renderQuestion();
      } else {
        finish();
      }
    }

    function finish(){
      clearInterval(timerId);
      $('#bar').style.width = '100%';
      $('#screen-quiz').style.display = 'none';
      $('#screen-result').style.display = '';

      const total = QUESTIONS.length;
      let correct = 0, omitted = 0;
      const reviewItems = [];

      QUESTIONS.forEach((q, i) => {
        const ans = answers[i];
        if(ans === 'omitida') omitted++;
        else if(ans === q.correct) correct++;

        const item = document.createElement('div');
        const ok = ans === q.correct;
        item.className = 'review-item ' + (ans==='omitida' ? '' : (ok?'correct':'incorrect'));
        const userTxt = ans==='omitida' ? '<em>Omitida</em>' : `${String.fromCharCode(65+ans)}. ${q.a[ans] ?? ''}`;
        const rightTxt = `${String.fromCharCode(65+q.correct)}. ${q.a[q.correct]}`;
        item.innerHTML = `<strong>${q.q}</strong><br>Tu respuesta: ${userTxt}<br>Correcta: <strong>${rightTxt}</strong>`;
        reviewItems.push(item);
      });

      const pct = Math.round((correct/total)*100);
      const scoreEl = $('#score');
      scoreEl.textContent = `Tu puntaje: ${correct}/${total} (${pct}%)`;
      scoreEl.className = 'score ' + (pct >= 85 ? 'good' : pct >= 60 ? 'ok' : 'bad');
      $('#summary').innerHTML = `Tiempo: <strong>${$('#timer').textContent}</strong> • Omitidas: <strong>${omitted}</strong>`;

      const list = $('#reviewList');
      list.innerHTML = '';
      reviewItems.forEach(el => list.appendChild(el));
    }
  </script>
</body>
</html>
